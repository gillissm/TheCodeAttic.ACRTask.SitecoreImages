version: v1.1.0
alias:
  src:
    - env.yml # Reference to the original variable set for consistency
steps:
  - id: nodejs
    build: -t $Registry/$AssetProjectName/nodejs:$NodeJsVersion -t $Registry/$AssetProjectName/nodejs:latest -f $ServicesPath/nodejs/Dockerfile . --build-arg PARENT_IMAGE=$NodeJsParentImage
    when: ["-"]
  - push: 
    - $Registry/$AssetProjectName/nodejs:$NodeJsVersion
    - $Registry/$AssetProjectName/nodejs:latest
# Assumes the base SQL images already exist within the registry
 - id: mssql-headless-hrz
    build: -t $Registry/$ComposeProjectName/mssql-headless-hrz:$TagVersion -t $Registry/$ComposeProjectName/mssql-headless-hrz:latest -f $ServicesPath/mssql/Dockerfile . --build-arg BASE_IMAGE=$Registry/$ComposeProjectName/mssql-hrz:latest --build-arg ASSET_IMAGE=$SitecoreModuleRegistry$HeadlessAssetImage
    when: ["-"]
  - push:
    - $Registry/$ComposeProjectName/mssql-headless-hrz:$TagVersion
    - $Registry/$ComposeProjectName/mssql-headless-hrz:latest
- id: mssql-headless
    build: -t $Registry/$ComposeProjectName/mssql-headless:$TagVersion -t $Registry/$ComposeProjectName/mssql-headless:latest -f $ServicesPath/mssql/Dockerfile . --build-arg BASE_IMAGE=$Registry/$ComposeProjectName/mssql-spe:$TagVersion --build-arg ASSET_IMAGE=$SitecoreModuleRegistry$HeadlessAssetImage
    when: ["-"]
  - push:
    - $Registry/$ComposeProjectName/mssql-headless:$TagVersion
    - $Registry/$ComposeProjectName/mssql-headless:latest
