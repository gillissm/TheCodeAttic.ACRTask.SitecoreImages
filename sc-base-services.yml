version: v1.1.0
alias:
  src:
    - env.yml
steps:
  - id: xdbsearchworker
    build: -t $Registry/$ComposeProjectName/xdbsearchworker:$ID -t $Registry/$ComposeProjectName/xdbsearchworker:latest -f $ServicesPath/xdbsearchworker/Dockerfile . --build-arg BASE_IMAGE=$SitecoreDockerRegistry$XDBSearchWorkerBaseImage:$SitecoreVersion
    when: ["-"]
  - push:
    - $Registry/$ComposeProjectName/xdbsearchworker:$ID
    - $Registry/$ComposeProjectName/xdbsearchworker:latest
  - id: xdbautomationworker
    build: -t $Registry/$ComposeProjectName/xdbautomationworker:$ID -t $Registry/$ComposeProjectName/xdbautomationworker:latest -f $ServicesPath/xdbautomationworker/Dockerfile . --build-arg BASE_IMAGE=$SitecoreDockerRegistry$XDBAutomationBaseImage:$SitecoreVersion
    when: ["-"]
  - push:
    - $Registry/$ComposeProjectName/xdbautomationworker:$ID
    - $Registry/$ComposeProjectName/xdbautomationworker:latest
  - id: cortexprocessingworker
    build: -t $Registry/$ComposeProjectName/cortexprocessingworker:$ID -t $Registry/$ComposeProjectName/cortexprocessingworker:latest -f $ServicesPath/cortexprocessingworker/Dockerfile . --build-arg BASE_IMAGE=$SitecoreDockerRegistry$CortexProcBaseImage:$SitecoreVersion
    when: ["-"]
  - push:
    - $Registry/$ComposeProjectName/cortexprocessingworker:$ID
    - $Registry/$ComposeProjectName/cortexprocessingworker:latest
  - id: xconnect
    build: -t $Registry/$ComposeProjectName/xconnect:$ID -t $Registry/$ComposeProjectName/xconnect:latest -f $ServicesPath/xconnect/Dockerfile . --build-arg BASE_IMAGE=$SitecoreDockerRegistry$XConnectBaseImage:$SitecoreVersion --build-arg TOOLING_IMAGE=$SitecoreToolsRegistry$SCToolingImage
    when: ["-"]
  - push:
    - $Registry/$ComposeProjectName/xconnect:$ID
    - $Registry/$ComposeProjectName/xconnect:latest